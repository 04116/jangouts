/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
"use strict";angular.module("janusHangouts",["ngAnimate","ngCookies","ngTouch","ngSanitize","blockUI","ui.router","ui.bootstrap","ngEmbed","janusHangouts.config","cfp.hotkeys","gridster","ngAudio","angular-extended-notifications","LocalStorageModule"]).config(["$stateProvider","$urlRouterProvider",function(e,n){e.state("signin",{url:"/sign_in?room",templateUrl:"app/signin/signin.html",controller:"SigninController",controllerAs:"vm",resolve:{StatesService:"StatesService",setRoomAndService:["StatesService","$state",function(e,n){return e.setRoomAndUser(n.toParams)}]}}).state("room",{url:"/rooms/:room?user",templateUrl:"app/room/room.html",controller:"RoomCtrl",resolve:{StatesService:"StatesService",setRoomAndService:["StatesService","$state",function(e,n){return e.setRoomAndUser(n.toParams)}]},onEnter:["UserService","RoomService",function(e,n){e.setSetting("lastRoom",n.getRoom().id)}]}),n.otherwise("/sign_in")}]).config(["blockUIConfig",function(e){e.templateUrl="app/room/consent-dialog.html",e.cssClass="block-ui block-ui-anim-fade consent-dialog",e.autoBlock=!1}]).config(["notificationsProvider",function(e){e.setDefaults({templatesDir:"app/templates/",faIcons:!0,closeOnRouteChange:"state"})}]).config(["localStorageServiceProvider",function(e){e.setPrefix("jh")}]).config(["$provide",function(e){e.decorator("$state",["$delegate","$rootScope",function(e,n){return n.$on("$stateChangeStart",function(n,t,o){e.toParams=o}),e}])}]).run(["$http","jhConfig",function(e,n){e.get("/config.json").then(function(e){angular.forEach(e.data,function(e,t){n[e]=t})},function(){console.warn("No configuration found")})}]).run(["$rootScope","$state","RoomService",function(e,n,t){e.$on("$stateChangeStart",function(){t.leave()}),e.$on("$stateChangeError",function(){n.go("signin")})}]),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(e){function n(){function n(){e.toggleChannel("video",i.feed)}function t(){return i.feed.isPublisher&&!i.feed.getVideoEnabled()}function o(){return i.feed.isPublisher&&i.feed.getVideoEnabled()}var i=this;i.toggle=n,i.showsEnable=t,i.showsDisable=o}return{restrict:"EA",templateUrl:"app/components/feed/buttons/jh-video-button.html",scope:{feed:"="},controllerAs:"vm",bindToController:!0,controller:n}}angular.module("janusHangouts").directive("jhVideoButton",e),e.$inject=["RoomService"]}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(e){function n(){function n(){e.unPublishFeed(o.feed.id)}function t(){return o.feed.isPublisher&&o.feed.isLocalScreen}var o=this;o.click=n,o.isVisible=t}return{restrict:"EA",templateUrl:"app/components/feed/buttons/jh-unpublish-button.html",scope:{feed:"="},controllerAs:"vm",bindToController:!0,controller:n}}angular.module("janusHangouts").directive("jhUnpublishButton",e),e.$inject=["RoomService"]}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(){function e(){function e(){o.clickFn()}function n(){return!o.sticky&&!o.feed.isIgnored}function t(){return o.sticky}var o=this;o.click=e,o.showsEnable=n,o.showsDisable=t}return{restrict:"EA",templateUrl:"app/components/feed/buttons/jh-sticky-button.html",scope:{feed:"=",clickFn:"&",highlighted:"=",sticky:"="},controllerAs:"vm",bindToController:!0,controller:e}}angular.module("janusHangouts").directive("jhStickyButton",e)}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(e){function n(){function n(){return!s.feed.isPublisher&&!s.feed.isIgnored}function t(){return s.feed.isIgnored}function o(){e.ignoreFeed(s.feed.id)}function i(){e.stopIgnoringFeed(s.feed.id)}var s=this;s.ignore=o,s.stopIgnoring=i,s.showsIgnore=n,s.showsStopIgnoring=t}return{restrict:"EA",templateUrl:"app/components/feed/buttons/jh-ignore-button.html",scope:{feed:"="},controllerAs:"vm",bindToController:!0,controller:n}}angular.module("janusHangouts").directive("jhIgnoreButton",e),e.$inject=["RoomService"]}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(e){function n(){function n(){e.toggleChannel("audio",r)}function t(){return r.isPublisher&&!r.isLocalScreen&&!r.getAudioEnabled()}function o(){return!r.isIgnored&&r.getAudioEnabled()}function i(){return!r.isPublisher&&!r.isIgnored&&!r.getAudioEnabled()}var s=this,r=s.feed;s.toggle=n,s.showsEnable=t,s.showsDisable=o,s.showsAudioOff=i}return{restrict:"EA",templateUrl:"app/components/feed/buttons/jh-audio-button.html",scope:{feed:"="},controllerAs:"vm",bindToController:!0,controller:n}}angular.module("janusHangouts").directive("jhAudioButton",e),e.$inject=["RoomService"]}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(e,n,t,o,i,s,r){function a(e,n){e.$on("gridster-resized",function(){e.vm.adjustAllSizes()}),r(function(){e.vm.adjustAllSizes()},600),e.$watch("vm.gridsterItems",function(){e.vm.gridsterIgnoreNextChange?e.vm.gridsterIgnoreNextChange=!1:e.vm.gridsterDirtyBit=!0,r(function(){e.vm.adjustAllSizes()},600)},!0),e.$watch(function(){return $("#thumbnails .thumb",n).size()},function(){e.vm.adjustFeedsSizes()})}function l(){function e(){var e=$(window).width()-25,n=$(window).height()-33-20-5,t=e/j,o=Math.floor(n/t);6>o&&(o=6);var i,s,r,a;return 10>o?(i=Math.ceil(o/2),s=Math.floor(o/2),r=i,a=8):(i=o,s=o-6,r=6,a=0),[{size:[8,6],position:[0,0],content:"Speaker"},{size:[8,i],position:[0,8],content:"Participants"},{size:[8,s],position:[r,a],content:"Chat"}]}function r(){y.gridsterDirtyBit&&(o.setSetting("gridsterItems",y.gridsterItems),i.info("Your layout has been successfully saved")),y.gridsterDirtyBit=!1}function a(){return!y.gridsterDirtyBit&&void 0===o.getSetting("gridsterItems")}function l(){return t.allFeeds()}function c(){if(null!==y.highlight.byUser)y.highlight.current=y.highlight.byUser;else{var e=y.highlight.current;if(e&&!e.isConnected()&&(e=null),!(e&&e.getSpeaking()&&e.getVideoEnabled())){var n=t.speakingFeed();y.highlight.current=n&&n.getVideoEnabled()?n:e||t.findMain()}}return y.highlight.current}function u(){var e=y.highlightedFeed();return e?e.isPublisher&&!e.isLocalScreen:!1}function d(e){y.highlight.byUser=y.highlight.byUser!==e?e:null}function h(e){return e===y.highlight.current}function g(e){return e===y.highlight.byUser}function f(){return n.allEntries()}function m(e){var n,t=e.innerWidth(),o=e.innerHeight();n=$("#main-video video",e),n.length&&n.css({height:o+"px",width:t+"px"}),n=$("#jh-chat-messages",e),n.length&&n.css({height:o-40+"px"}),n=$("#thumbnails",e),n.length&&(n.css({height:o+"px",width:t+"px"}),S())}function p(){$(".gridster-item").each(function(e,n){m($(n))})}function v(){s.toggleCheatSheet()}function b(){y.windowResizeModeOn=!y.windowResizeModeOn,y.gridsterOpts.resizable.enabled=y.windowResizeModeOn,y.gridsterOpts.draggable.enabled=y.windowResizeModeOn,y.windowResizeModeOn||r()}function w(){a()||(y.gridsterIgnoreNextChange=!0,y.gridsterDirtyBit=!1,y.gridsterItems=e(),o.removeSetting("gridsterItems"),i.info("Your layout preferences have been deleted"))}function S(){var e,n,t,o,i=$("#thumbnails"),s=i.innerWidth(),r=i.innerHeight(),a=4,l=33,c=$(".thumb",i).size(),u=!0;for(e=128;e>=64;e-=4)if(t=.75*e+l,n=Math.floor(s/(e+a)),o=Math.ceil(c/n),r>=o*t){u=!1;break}64>e&&(e=64),$(".face",i).css({height:.75*e+"px",width:e+"px"}),i.css(u?{"overflow-y":"scroll"}:{"overflow-y":"hidden"})}var y=this,j=16;y.gridsterDirtyBit=!1,y.gridsterIgnoreNextChange=!0,y.gridsterItems=o.getSetting("gridsterItems")||e(),y.gridsterOpts={columns:j,resizable:{enabled:!1},draggable:{enabled:!1}},y.highlight={byUser:null,current:null},y.feeds=l,y.highlightedFeed=c,y.mirrored=u,y.toggleHighlightedFeed=d,y.isHighlighted=h,y.isHighlightedByUser=g,y.logEntries=f,y.adjustAllSizes=p,y.adjustFeedsSizes=S,y.showHotkeys=v,y.windowResizeModeOn=!1,y.toggleWindowResizeMode=b,y.setDefaultLayout=w}return{restrict:"EA",templateUrl:"app/components/videochat/jh-video-chat.html",scope:{},controllerAs:"vm",bindToController:!0,link:a,controller:l}}angular.module("janusHangouts").directive("jhVideoChat",e),e.$inject=["$window","LogService","FeedsService","UserService","Notifier","hotkeys","$timeout"]}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(e,n){function t(){function t(){n(function(){e.videoThumbnails=!e.videoThumbnails})}function o(){return e.videoThumbnails}var i=this;i.click=t,i.isChecked=o}return{restrict:"EA",templateUrl:function(e,n){var t="app/components/videochat/jh-thumbnails-mode-button";return n.textTemplate?t+"-with-text.html":t+".html"},scope:{},controllerAs:"vm",bindToController:!0,controller:t}}angular.module("janusHangouts").directive("jhThumbnailsModeButton",e),e.$inject=["jhConfig","$timeout"]}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(e){var n="userSettings";this.user=null,this.settings=e.get(n)||{},this.getUser=function(){return this.user},this.signin=function(e){this.setSetting("lastUsername",e),this.user={username:e}},this.getSettings=function(){return this.settings},this.getSetting=function(e){return this.settings[e]},this.removeSetting=function(e){delete this.settings[e],this.storeSettings()},this.clearSettings=function(){return this.settings={},e.clearAll(n)},this.setSetting=function(e,n){this.settings[e]=n,this.storeSettings()},this.storeSettings=function(){e.set(n,this.settings)}}angular.module("janusHangouts").service("UserService",e),e.$inject=["localStorageService"]}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(e,n,t){function o(e,n){setTimeout(function(){$("#inputUsername",n).focus()},100),e.vm.adjustHeight(),$(window).on("resize",function(){e.vm.adjustHeight()})}function i(){function o(){a.room&&a.username&&e.go("room",{room:a.room.id,user:a.username})}function i(){return a.listRooms===!0}function s(){return a.listRooms===!1}function r(){var e=$(window).outerHeight()-$("footer").outerHeight();$("#signin").css({height:e+"px"})}var a=this;a.signin=o,a.adjustHeight=r,a.showRoomsList=i,a.showRoom=s,a.username=null,a.room=null,a.rooms=[],a.listRooms=null,n.getRooms().then(function(e){if(a.room=n.getRoom(),a.rooms=e,a.listRooms=null===a.room,null!==t.getUser()&&(a.username=t.getUser().username),null===a.room){var o=t.getSetting("lastRoom");a.room=_.find(e,function(e){return e.id===o})}})}return{restrict:"EA",templateUrl:"app/components/user/jh-signin-form.html",scope:!0,link:o,controllerAs:"vm",bindToController:!0,controller:i}}angular.module("janusHangouts").directive("jhSigninForm",e),e.$inject=["$state","RoomService","UserService"]}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(e,n,t){function o(n){var t=this;e(function(){t.inProgress=n})}function i(){return this.inProgress}function s(){return"https:"===window.location.protocol}function r(){return t.httpsAvailable?t.httpsUrl?t.httpsUrl:"https://"+window.location.hostname+window.location.pathname:null}function a(){n.open({animation:!0,templateUrl:"app/components/screen-share/screen-share-help.html",controller:"ScreenShareHelpCtrl",controllerAs:"vm"})}this.inProgress=!1,this.setInProgress=o,this.getInProgress=i,this.showHelp=a,this.usingSSL=s,this.httpsUrl=r}angular.module("janusHangouts").service("ScreenShareService",e),e.$inject=["$timeout","$modal","jhConfig"]}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(e){function n(){e.dismiss("cancel")}function t(){return window.location.hostname}var o=this;o.close=n,o.hostname=t}angular.module("janusHangouts").controller("ScreenShareHelpCtrl",e),e.$inject=["$modalInstance"]}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(e){function n(){function n(){return t.usingSSL()||t.httpsUrl()}var t=this;t.showHelp=function(){e.showHelp()},t.usingSSL=function(){return e.usingSSL()},t.httpsUrl=function(){return e.httpsUrl()},t.visible=n}return{restrict:"EA",templateUrl:"app/components/screen-share/jh-screen-share-hint.html",scope:!0,controllerAs:"vm",bindToController:!0,controller:n}}angular.module("janusHangouts").directive("jhScreenShareHint",e),e.$inject=["ScreenShareService"]}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(e,n){function t(){function t(){s.enabled()&&n.publishScreen()}function o(){return e.usingSSL()&&!e.getInProgress()}function i(){return s.enabled()?"Share a window/desktop":e.getInProgress()?"Wait while the screen is shared":"Screen sharing disabled (no SSL?)"}var s=this;s.click=t,s.enabled=o,s.title=i}return{restrict:"EA",templateUrl:"app/components/screen-share/jh-screen-share-button.html",scope:!0,controllerAs:"vm",bindToController:!0,controller:t}}angular.module("janusHangouts").directive("jhScreenShareButton",e),e.$inject=["ScreenShareService","RoomService"]}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(e,n,t){this.setRoomAndUser=function(o){var i=e.defer(),s=o.user||t.getSetting("lastUsername");void 0!==s&&t.signin(s);var r=parseInt(o.room);return Number.isNaN(r)?(n.setRoom(null),i.resolve()):n.getRooms().then(function(e){var t=_.find(e,function(e){return e.id===r});n.setRoom(t||null),i.resolve()}),i.promise}}angular.module("janusHangouts").service("StatesService",e),e.$inject=["$q","RoomService","UserService"]}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(){return function(e){e=e||{},_.assign(this,e),this.id=this.room,this.label=this.description+" ("+this.num_participants+"/"+this.max_publishers+" users)"}}angular.module("janusHangouts").factory("Room",e)}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(e,n,t,o,i,s,r,a,l,c){function u(){var e,n;return"https:"===window.location.protocol?(e="wss:",n="8989"):(e="ws:",n="8188"),[e+"//"+window.location.hostname+":"+n+"/janus/",window.location.protocol+"//"+window.location.hostname+"/janus/"]}function d(){var n=e.defer();return null===R.janus?(Janus.init({debug:l.janusDebug}),R.janus=new Janus({server:R.server,success:function(){n.resolve()},error:function(e){var t="Janus error: "+e;t+="\nDo you want to reload in order to retry?",n.reject(),window.confirm(t)&&window.location.reload()},destroyed:function(){console.log("Janus object destroyed")}})):n.resolve(),n.promise}function h(e){var t=n,i=null;R.janus.attach({plugin:"janus.plugin.videoroom",success:function(n){i=new s(n,R.room.id,"main"),i.register(e)},error:function(e){console.error("Error attaching plugin... "+e)},consentDialog:function(e){console.log("Consent dialog should be "+(e?"on":"off")+" now"),t.$broadcast("consentDialog.changed",e)},ondataopen:function(){console.log("The publisher DataChannel is available"),i.onDataOpen(),x()},onlocalstream:function(e){console.log(" ::: Got a local stream :::");var n=o.findMain();n.setStream(e)},oncleanup:function(){console.log(" ::: Got a cleanup notification: we are unpublished now :::")},onmessage:function(n,o){var s=n.videoroom;if(console.log("Event: "+s),"joined"===s)console.log("Successfully joined room "+n.room),a.enterRoom(n.id,e,i),i.publish({error:function(){i.publish({noCamera:!0})}}),n.publishers instanceof Array&&n.publishers.length>0&&R.subscribeToFeeds(n.publishers,R.room.id);else if("destroyed"===s)console.log("The room has been destroyed!"),t.$broadcast("room.destroy");else if("event"===s)if(n.publishers instanceof Array&&n.publishers.length>0)R.subscribeToFeeds(n.publishers,R.room.id);else if(void 0!==n.leaving&&null!==n.leaving){var r=n.leaving;a.destroyFeed(r)}else if(void 0!==n.unpublished&&null!==n.unpublished){var l=n.unpublished;a.destroyFeed(l)}else n.configured?i.confirmConfig():void 0!==n.error&&null!==n.error&&(console.log("Error message from server"+n.error),t.$broadcast("room.error",n.error));void 0!==o&&null!==o&&i.handleRemoteJsep(o)}})}function g(){var n=e.defer();return R.janus.attach({plugin:"janus.plugin.videoroom",success:function(e){console.log("getAvailableRooms plugin attached ("+e.getPlugin()+", id="+e.getId()+")");var t={request:"list"};e.send({message:t,success:function(t){if(e.detach(),"success"===t.videoroom){var o=_.map(t.list,function(e){return new i(e)});o=_.sortBy(o,"label"),n.resolve(o)}else n.reject()}})}}),n.promise}function f(n){var t=e.defer();return d().then(function(){h(n),t.resolve()}),t.promise}function m(){a.leaveRoom()}function p(e){this.room=e}function v(){return this.room}function b(){var n=e.defer();return null===this.rooms?d().then(function(){g().then(function(e){R.rooms=e,n.resolve(e)})}):n.resolve(this.rooms),n.promise}function w(e){console.log("Got a list of available publishers/feeds:"),console.log(e);for(var n=0;n<e.length;n++){var t=e[n].id,i=e[n].display;console.log("  >> ["+t+"] "+i);var s=o.find(t);(null===s||s.waitingForConnection())&&this.subscribeToFeed(t,i)}}function S(e,n){var i=o.find(e),c=null;i&&(n=i.display),this.janus.attach({plugin:"janus.plugin.videoroom",success:function(n){c=new s(n,R.room.id,"subscriber"),c.listen(e)},error:function(e){console.error("  -- Error attaching plugin... "+e)},onmessage:function(o,s){console.log(" ::: Got a message (listener) :::"),console.log(JSON.stringify(o));var r=o.videoroom;console.log("Event: "+r),"attached"===r?t(function(){i?a.stopIgnoringFeed(e,c):a.remoteJoin(e,n,c),console.log("Successfully attached to feed "+e+" ("+n+") in room "+o.room)}):o.configured?c.confirmConfig():o.started?c.setConfig({values:{audio:!0,video:l.videoThumbnails}}):console.log("What has just happened?!"),void 0!==s&&null!==s&&c.subscribe(s)},onremotestream:function(n){o.waitFor(e).then(function(e){e.setStream(n)},function(e){console.error(e)})},ondataopen:function(){console.log("The subscriber DataChannel is available"),c.onDataOpen(),x()},ondata:function(n){console.log(" ::: Got info in the data channel (subscriber) :::"),r.receiveMessage(n,e)},oncleanup:function(){console.log(" ::: Got a cleanup notification (remote feed "+e+") :::")}})}function y(){var e,n,t=o.findMain().display;this.janus.attach({plugin:"janus.plugin.videoroom",success:function(n){e=new s(n,R.room.id,"screen"),e.register(t),c.setInProgress(!0)},error:function(e){console.error("  -- Error attaching screen plugin... "+e)},onlocalstream:function(e){console.log(" ::: Got the screen stream :::");var t=o.find(n);t.setStream(e)},onmessage:function(o,i){console.log(" ::: Got a message (screen) :::"),console.log(o);var s=o.videoroom;"joined"===s?(n=o.id,a.publishScreen(n,t,e),e.publish({success:function(){c.setInProgress(!1)},error:function(e){console.log(e),j(n),c.setInProgress(!1),c.showHelp()}})):o.configured?e.confirmConfig():console.log("Unexpected event for screen"),void 0!==i&&null!==i&&e.handleRemoteJsep(i)}})}function j(e){a.destroyFeed(e)}function k(e){a.ignoreFeed(e)}function C(e){this.subscribeToFeed(e)}function $(e,n){a.toggleChannel(e,n)}function x(){o.publisherFeeds().forEach(function(e){r.sendStatus(e,{exclude:"picture"}),t(function(){r.sendStatus(e)},4e3)})}this.enter=f,this.leave=m,this.setRoom=p,this.getRoom=v,this.getRooms=b,this.publishScreen=y,this.unPublishFeed=j,this.ignoreFeed=k,this.stopIgnoringFeed=C,this.subscribeToFeeds=w,this.subscribeToFeed=S,this.toggleChannel=$,this.room=null,this.rooms=null,this.janus=null;var R=this;this.server=l.janusServer?l.janusServer:u(),l.janusServerSSL&&"https:"===window.location.protocol&&(this.server=l.janusServerSSL)}angular.module("janusHangouts").service("RoomService",e),e.$inject=["$q","$rootScope","$timeout","FeedsService","Room","FeedConnection","DataChannelService","ActionService","jhConfig","ScreenShareService"]}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(e){function n(n){var t=this;e(function(){t.entries.push(n)})}function t(){return this.entries}this.entries=[],this.add=n,this.allEntries=t}angular.module("janusHangouts").service("LogService",e),e.$inject=["$timeout"]}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(e){return function(n,t){this.type=n,this.timestamp=new Date,this.content=t||{},this.text=function(){return this[this.type+"Text"]()},this.muteRequestText=function(){var e;return e=this.content.source.isPublisher?"You have muted ":this.content.source.display+" has muted ",e+=this.content.target.isPublisher?"you":this.content.target.display},this.chatMsgText=function(){return e(this.content.text).trim()},this.publishScreenText=function(){return"Screen sharing started"},this.destroyFeedText=function(){return this.content.feed.isLocalScreen?"Screen sharing stopped":this.content.feed.display+" has left the room"},this.newRemoteFeedText=function(){return this.content.feed.display+" has joined the room"},this.ignoreFeedText=function(){return"You are ignoring "+this.content.feed.display+" now"},this.stopIgnoringFeedText=function(){return"You are not longer ignoring "+this.content.feed.display},this.hasText=function(){return""!==this.text()}}}angular.module("janusHangouts").factory("LogEntry",["$sanitize",e])}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(e,n){function t(){var t=this;t.leave=function(){n.setRoom(null),e.go("signin")}}return{restrict:"EA",templateUrl:"app/components/room/jh-leave-button.html",scope:!0,controller:t,controllerAs:"vm"}}angular.module("janusHangouts").directive("jhLeaveButton",e),e.$inject=["$state","RoomService"]}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(e,n,t,o){function i(i,s){var r,a,l=JSON.parse(i),c=l.type,u=l.content;"chatMsg"===c?(a=new n("chatMsg",{feed:e.find(s),text:u}),a.hasText()&&t.add(a)):"muteRequest"===c?(r=e.find(u.target),r.isPublisher&&r.setEnabledChannel("audio",!1,{after:function(){o.$broadcast("muted.byRequest")}}),a=new n("muteRequest",{source:e.find(s),target:r}),t.add(a)):"statusUpdate"===c?(r=e.find(u.source),r&&!r.isPublisher&&r.setStatus(u.status)):console.log("Unknown data type: "+c)}function s(e){var n={target:e.id};l("muteRequest",n)}function r(e,n){var t={source:e.id,status:e.getStatus(n)};l("statusUpdate",t)}function a(e){l("chatMsg",e)}function l(n,t){var o=JSON.stringify({type:n,content:t}),i=e.findMain();if(null!==i){if(!i.isDataOpen())return void console.log("Data channel not open yet. Skipping");var s=i.connection;s.sendData({text:o,error:function(e){alert(e)},success:function(){console.log("Data sent: "+n)}})}}this.sendStatus=r,this.sendMuteRequest=s,this.sendChatMessage=a,this.receiveMessage=i}angular.module("janusHangouts").service("DataChannelService",e),e.$inject=["FeedsService","LogEntry","LogService","$rootScope"]}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(e,n,t,o,i,s,r){function a(e,o,i){var s=new n({display:o,connection:i,id:e,isPublisher:!0});t.add(s,{main:!0})}function l(){var e=this;_.forEach(t.allFeeds(),function(n){e.destroyFeed(n.id)})}function c(e,s,r){var a=new n({display:s,connection:r,id:e,isPublisher:!0,isLocalScreen:!0});t.add(a);var l=new o("publishScreen");i.add(l)}function u(e,s,r){var a=new n({display:s,connection:r,id:e,isPublisher:!1});t.add(a);var l=new o("newRemoteFeed",{feed:a});i.add(l)}function d(n){var s=t.find(n);if(null!==s){e(function(){s.disconnect(),t.destroy(n)});var r=new o("destroyFeed",{feed:s});i.add(r)}}function h(e){var n=t.find(e);if(null!==n){n.ignore();var s=new o("ignoreFeed",{feed:n});i.add(s)}}function g(e,n){var s=t.find(e);if(null!==s){s.stopIgnoring(n);var r=new o("stopIgnoringFeed",{feed:s});i.add(r)}}function f(e){var n=new o("chatMsg",{feed:t.findMain(),text:e});n.hasText()&&(i.add(n),s.sendChatMessage(e))}function m(e,n){if(n||(n=t.findMain())){if(!n.isPublisher){var s=new o("muteRequest",{source:t.findMain(),target:n});i.add(s)}if(n.isEnabled(e)){var a=null;"audio"===e&&n.isPublisher&&(a=function(){r.$broadcast("muted.byUser")}),n.setEnabledChannel(e,!1,{after:a})}else n.setEnabledChannel(e,!0)}}this.enterRoom=a,this.leaveRoom=l,this.remoteJoin=u,this.destroyFeed=d,this.ignoreFeed=h,this.stopIgnoringFeed=g,this.writeChatMessage=f,this.publishScreen=c,this.toggleChannel=m}angular.module("janusHangouts").service("ActionService",e),e.$inject=["$timeout","Feed","FeedsService","LogEntry","LogService","DataChannelService","$rootScope"]}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(e){function n(n){e.info("Information",n,{duration:5e3,attachTo:$("#videochat-body")})}this.info=n}angular.module("janusHangouts").service("Notifier",e),e.$inject=["notifications"]}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(e,n,t,o){function i(){r("You have been muted by another user.")}function s(){r("Trying to say something? You are muted.")}function r(e){if(!(e in l))var t=n.info("Muted",e,{show:function(){a.play()},duration:2e4,attachTo:$("#videochat-body"),actions:[{label:"Unmute",className:"btn btn-default",fn:function(){o.toggleChannel("audio"),t.close()}},{label:"Do not show again",className:"btn btn-default",fn:function(){l[e]=!0,t.close()}}]})}this.speaking=s,this.muted=i;var a=t.load("assets/sounds/bell.ogg"),l={}}angular.module("janusHangouts").service("MuteNotifier",e),e.$inject=["$animate","notifications","ngAudio","ActionService"]}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(e){function n(){this.version=e.version}return{restrict:"EA",templateUrl:"app/components/footer/jh-footer.html",scope:!0,controller:n,controllerAs:"vm"}}angular.module("janusHangouts").directive("jhFooter",e),e.$inject=["jhConfig"]}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(e){return function(n,t){function o(){var e,n=i();n&&!h?(e=_.sum(_.slice(g,g.length-3)),e>=2&&(h=!0,t.start&&t.start())):!n&&h&&(e=_.sum(g),0===e&&(h=!1,t.stop&&t.stop())),g.shift(),g.push(0+n)}function i(){c.getFloatFrequencyData(u);for(var e=4,n=u.length;n>e;e++)if(u[e]>r&&u[e]<0)return!0;return!1}t=t||{};var s=t.interval||65,r=t.threshold||-50,a=window.AudioContext||window.webkitAudioContext,l=new a,c=l.createAnalyser();c.fftSize=512,c.smoothingTimeConstant=.1;var u=new window.Float32Array(c.fftSize),d=l.createMediaStreamSource(n);d.connect(c);var h=!1,g=_.fill(new Array(10),0),f=e(function(){"suspended"===l.state?l.resume():o()},s);this.destroy=function(){e.cancel(f)},this.isSpeaking=function(){return h}}}angular.module("janusHangouts").factory("SpeakObserver",e),e.$inject=["$interval"]}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(){function e(e,n){e.$watch("vm.feed.getStream()",function(e){if(void 0!==e){var t=$("video",n)[0];t.muted=!0,attachMediaStream(t,e)}})}function n(){}return{restrict:"EA",templateUrl:"app/components/feed/jh-main-feed.html",scope:{feed:"=",message:"@"},controllerAs:"vm",bindToController:!0,controller:n,link:e}}angular.module("janusHangouts").directive("jhMainFeed",e)}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(e,n,t,o){function i(e,i){function s(e){return Date.now()+1e3*e}function r(){return s(0)}e.$watch("vm.feed.getStream()",function(n){if(void 0!==n){var t=$("video",i)[0];t.muted=e.vm.feed.isPublisher,attachMediaStream(t,n)}});var a=e.vm,l=a.feed;if(l.isPublisher){if(a.initPics(i),a.takePic(),n(a.takePic,2e4),!l.isLocalScreen){var c=r();e.$on("muted.byRequest",function(){c=s(3),o.muted()}),e.$on("muted.byUser",function(){c=r()}),e.$watch("vm.feed.isVoiceDetected()",function(e){e&&l.getAudioEnabled()===!1&&r()>c&&(o.speaking(),c=s(60))})}}else l.setVideoSubscription(t.videoThumbnails||a.highlighted),e.$watch(function(){return t.videoThumbnails||a.highlighted||!a.feed.isSilent()},function(e){l.setVideoSubscription(e)})}function s(){function e(){return o.highlighted||o.feed.isIgnored?"placeholder":o.feed.getVideoEnabled()?o.feed.isPublisher?"video":o.feed.getVideoSubscription()?"video":o.feed.getPicture()?"picture":"placeholder":"placeholder"}function n(e){var n=$("canvas",e),t=n[0],i=$("video",e).first(),s=t.getContext("2d");t.width=n.width(),t.height=Math.round(.75*t.width);var r=new window.Image;r.src="assets/images/placeholder.png",r.onload=function(){s.drawImage(r,0,0,t.width,t.height)},o.picCanvas=n,o.picSource=i,o.picContext=s}function t(){var e=o.picCanvas[0],n=e.width;if(o.picSource[0].videoHeight){var t=n*o.picSource[0].videoHeight/o.picSource[0].videoWidth;e.height=t,o.picContext.drawImage(o.picSource[0],0,0,n,t),o.feed.updateLocalPic(e.toDataURL("image/jpeg",.4))}}var o=this;o.mirrored=o.feed.isPublisher&&!o.feed.isLocalScreen,o.thumbnailTag=e,o.initPics=n,o.takePic=t}return{restrict:"EA",templateUrl:"app/components/feed/jh-feed.html",scope:{feed:"=",toggleHighlightFn:"&",highlighted:"=",highlightedByUser:"="},controllerAs:"vm",bindToController:!0,controller:s,link:i}}angular.module("janusHangouts").directive("jhFeed",e),e.$inject=["RoomService","$interval","jhConfig","MuteNotifier"]}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(e,n){function t(e){return this.feeds[e]||null}function o(){return this.mainFeed}function i(t,o,i){var s=e.defer(),r=this.find(t),a=this;if(o=o||10,i=i||1e3,null===r)var l=n.setInterval(function(){r=a.find(t),null===r?o-=1:(n.clearInterval(l),s.resolve(r)),0===o&&(n.clearInterval(l),s.reject("feed with id "+t+" was not found"))},i);else s.resolve(r);return s.promise}function s(e,n){this.feeds[e.id]=e,n&&n.main&&(this.mainFeed=e)}function r(e){delete this.feeds[e],this.mainFeed&&e===this.mainFeed.id&&(this.mainFeed=null)}function a(){return _.values(this.feeds)}function l(){return _.filter(this.allFeeds(),function(e){return e.isPublisher})}function c(){return _.filter(this.allFeeds(),function(e){return e.isLocalScreen})}function u(){return _.detect(this.allFeeds(),function(e){return e.getSpeaking()})}this.mainFeed=null,this.feeds={},this.find=t,this.findMain=o,this.add=s,this.destroy=r,this.allFeeds=a,this.publisherFeeds=l,this.localScreenFeeds=c,this.speakingFeed=u,this.waitFor=i}angular.module("janusHangouts").service("FeedsService",e),e.$inject=["$q","$window"]}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(e,n,t){return function(o){function i(t){e(function(){s.isEnabled("audio")===!1&&(t=!1),a!==t&&(a=t,t===!1&&(l=Date.now()),n.sendStatus(s,{exclude:"picture"}))})}o=o||{};var s=this;this.id=o.id||0,this.display=o.display||null,this.connection=o.connection||null,this.isPublisher=o.isPublisher||!1,this.isLocalScreen=o.isLocalScreen||!1,this.isIgnored=o.ignored||!1;var r=null,a=!1,l=Date.now(),c=!0,u=!0,d=null,h=null;this.isEnabled=function(e){return this.isPublisher?this.connection&&this.connection.getConfig()?this.connection.getConfig()[e]:null:"audio"===e?u:c},this.setPicture=function(e){r=e},this.getPicture=function(){return r},this.setStream=function(e){this.isPublisher&&!this.isLocalScreen&&(h=new t(e,{start:function(){i(!0)},stop:function(){i(!1)}})),d=e},this.getStream=function(){return d},this.setSpeaking=function(e){a=e},this.getSpeaking=function(){return a},this.setAudioEnabled=function(e){u=e},this.getAudioEnabled=function(){return this.isEnabled("audio")},this.setVideoEnabled=function(e){c=e},this.getVideoEnabled=function(){return this.isEnabled("video")},this.isVoiceDetected=function(){return h&&h.isSpeaking()},this.isDataOpen=function(){return this.connection?this.connection.isDataOpen:!1},this.isConnected=function(){return null!==this.connection},this.disconnect=function(){this.connection&&this.connection.destroy(),h&&h.destroy(),this.connection=null},this.ignore=function(){this.isIgnored=!0,this.disconnect()},this.stopIgnoring=function(e){this.isIgnored=!1,this.connection=e},this.waitingForConnection=function(){return this.isIgnored===!1&&!this.connection},this.setEnabledChannel=function(t,o,i){var s=this;if(i=i||{},this.isPublisher){var r={};if(r[t]=o,this.connection.setConfig({values:r,ok:function(){e(function(){"audio"===t&&o===!1&&(a=!1),i.after&&i.after(),n.sendStatus(s,{exclude:"picture"})})}}),"video"===t){var l=d.getVideoTracks();null!==l&&void 0!==l&&(l[0].enabled=o)}}else"audio"===t&&o===!1&&n.sendMuteRequest(this)},this.updateLocalPic=function(t){var o=this;e(function(){r=t,n.sendStatus(o)})},this.getStatus=function(e){e=e||{},e.exclude||(e.exclude=[]);var n=["audioEnabled","videoEnabled","speaking","picture"],t={};return _.forEach(n,function(n){_.includes(e.exclude,n)||(t[n]=s["get"+_.capitalize(n)]())}),t},this.setStatus=function(n){var t=this;e(function(){a===!0&&n.speaking===!1&&(l=Date.now()),_.forEach(n,function(e,n){t["set"+_.capitalize(n)](e)})})},this.isSilent=function(e){return e||(e=6e3),!a&&l<Date.now()-e},this.setVideoSubscription=function(e){this.connection.setConfig({values:{video:e}})},this.getVideoSubscription=function(){return this.connection&&this.connection.getConfig()?this.connection.getConfig().video:null}}}angular.module("janusHangouts").factory("Feed",e),e.$inject=["$timeout","DataChannelService","SpeakObserver"]}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(e){return function(n,t,o){var i=this;this.pluginHandle=n,this.role=o||"subscriber",this.isDataOpen=!1,this.config=null,console.log(this.role+" plugin attached ("+n.getPlugin()+", id="+n.getId()+")"),this.destroy=function(){this.config=null,this.pluginHandle.detach()},this.register=function(e){var o={request:"join",room:t,ptype:"publisher",display:e};n.send({message:o})},this.listen=function(e){var o={request:"join",room:t,ptype:"listener",feed:e};n.send({message:o})},this.handleRemoteJsep=function(e){n.handleRemoteJsep({jsep:e})},this.sendData=function(e){n.data(e)},this.publish=function(t){t=t||{};var o={videoRecv:!1,audioRecv:!1},s={video:!0,audio:!0};"main"===this.role?(t.noCamera?(o.videoSend=!1,s.video=!1):o.videoSend=!0,o.audioSend=!0,o.data=!0):(s.audio=!1,o.video="screen",o.audioSend=!1,o.data=!1),n.createOffer({media:o,success:function(o){console.log("Got publisher SDP!"),console.log(o),i.config=new e(n,s,o),t.success&&t.success()},error:function(e){console.error("WebRTC error publishing"),console.error(e),t.error&&t.error()}})},this.subscribe=function(e){n.createAnswer({jsep:e,media:{audioSend:!1,videoSend:!1,data:!0},success:function(e){console.log("Got SDP!"),console.log(e);var o={request:"start",room:t};n.send({message:o,jsep:e})},error:function(e){console.error("WebRTC error subscribing"),console.error(e)}})},this.setConfig=function(t){this.config?this.config.set(t):this.config=new e(n,t.values,null,t.ok)},this.getConfig=function(){return this.config?this.config.get():void 0},this.confirmConfig=function(){return this.config?this.config.confirm():void 0},this.onDataOpen=function(){this.isDataOpen=!0}}}angular.module("janusHangouts").factory("FeedConnection",e),e.$inject=["ConnectionConfig"]}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(e){return function(n,t,o,i){function s(e){return e.video!==c.video||e.audio!==c.audio}function r(e){e=e||{};var t={request:"configure"};l={},_.assign(l,a,c),_.assign(t,l),n.send({message:t,jsep:e.jsep,success:function(){u=e.ok},error:function(){l=null,console.error("Config request not sent")}})}var a={},l=null,c={audio:!0,video:!0},u=null;_.assign(c,t),r({jsep:o,ok:i}),this.get=function(){return a},this.set=function(e){e=e||{},e.values=e.values||{};var n={};_.assign(n,a,c),_.assign(c,a,e.values),null===l&&s(n)&&r({ok:e.ok})},this.confirm=function(){e(function(){null===l?console.error("I haven't sent a config. Where does this confirmation come from?"):(a=l,l=null,console.log("Connection configured",a),u&&u(),s(a)&&r())})}}}angular.module("janusHangouts").factory("ConnectionConfig",e),e.$inject=["$timeout"]}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(){function e(){var e=this;e.text=e.message.text()}return{restrict:"EA",templateUrl:"app/components/chat/jh-log-entry.html",scope:{message:"="},controllerAs:"vm",bindToController:!0,controller:e}}angular.module("janusHangouts").directive("jhLogEntry",e)}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(){function e(e){e.$watch("vm.messages.length",function(e){if(void 0!==e){var n=document.getElementById("jh-chat-messages");setTimeout(function(){n.scrollTop=n.scrollHeight},100)}})}function n(){}return{restrict:"EA",templateUrl:"app/components/chat/jh-chat.html",scope:{messages:"="},link:e,controllerAs:"vm",bindToController:!0,controller:n}}angular.module("janusHangouts").directive("jhChat",e)}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(){function e(){var e=this;e.embedOptions={link:!0,linkTarget:"_blank",image:{embed:!0},pdf:{embed:!1},audio:{embed:!0},code:{highlight:!1},basicVideo:!0,tweetEmbed:!1}}return{restrict:"EA",templateUrl:"app/components/chat/jh-chat-message.html",scope:{message:"="},controllerAs:"vm",bindToController:!0,controller:e}}angular.module("janusHangouts").directive("jhChatMessage",e)}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(e){function n(){function n(){e.writeChatMessage(t.text),t.text=null}var t=this;t.text=null,t.submit=n}return{restrict:"EA",templateUrl:"app/components/chat/jh-chat-form.html",scope:{message:"="},controllerAs:"vm",bindToController:!0,controller:n}}angular.module("janusHangouts").directive("jhChatForm",e),e.$inject=["ActionService"]}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(e){function n(){function n(){e.open({animation:!0,templateUrl:"app/components/browser-info/browser-info.html",controller:"BrowserInfoCtrl",controllerAs:"vm"})}var t=this;t.showHelp=n}return{restrict:"EA",templateUrl:"app/components/browser-info/jh-browser-info.html",scope:!0,controllerAs:"vm",bindToController:!0,controller:n}}angular.module("janusHangouts").directive("jhBrowserInfo",e),e.$inject=["$modal"]}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(e){function n(){e.dismiss("cancel")}var t=this;t.close=n}angular.module("janusHangouts").controller("BrowserInfoCtrl",e),e.$inject=["$modalInstance"]}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(){}angular.module("janusHangouts").controller("SigninController",e)}(),/*
 * Copyright (C) 2015 SUSE Linux
 *
 * This software may be modified and distributed under the terms
 * of the MIT license.  See the LICENSE.txt file for details.
 */
function(){function e(e,n,t,o,i,s){var r=i.getRoom(),a=o.getUser(),l={};null===r||null===a?(null!==r&&(l.room=r.id),n.go("signin",l)):void 0===n.params.user?(l.room=r.id,l.user=a.username,n.go(n.current.name,l,{location:"replace"})):i.enter(a.username),e.$on("room.error",function(e,n){alert("Janus server reported the following error:\n"+n)}),e.$on("consentDialog.changed",function(e,n){n?t.start():n||t.stop()}),s.bindTo(e).add({combo:"alt+m",description:"Mute or unmute your microphone",callback:function(){i.toggleChannel("audio")}}).add({combo:"alt+n",description:"Disable or enable camera",callback:function(){i.toggleChannel("video")}}).add({combo:"alt+q",description:"Sign out",callback:function(){o.signout()}}),e.hotkeys=s}angular.module("janusHangouts").controller("RoomCtrl",e),e.$inject=["$scope","$state","blockUI","UserService","RoomService","hotkeys"]}(),function(){angular.module("janusHangouts.config",[]).provider("jhConfig",function(){var e={janusServer:null,janusServerSSL:null,janusDebug:!1,httpsAvailable:!0,httpsUrl:null,videoThumbnails:!0};return{$get:function(){return e},$set:function(n,t){e[n]=t}}})}(),angular.module("janusHangouts").run(["$templateCache",function(e){e.put("app/room/consent-dialog.html",'<img src="assets/images/up_arrow.png">'),e.put("app/room/room.html",'<div class="row" id="main-chat-session"><div jh-video-chat="true"></div></div>'),e.put("app/signin/signin.html",'<div id="signin"><jh-signin-form></jh-signin-form></div>'),e.put("app/templates/global-notification.html",'<style>\n  #global-notifications{position:fixed;z-index:1030;top:51px;left:0;text-align:center;background-color:#cfe1e9;color:#212121;width:100%;}\n  .global-notification{padding: 4px 10px;}\n  .global-notification .icon{margin-right:5px !important}\n  .global-notification .close-button{color:#777;margin-left:10px !important;cursor:pointer}\n  .global-notification .close-button:hover{color:#3b3b3b}\n  .global-notification.notification-warning{background-color:#ffe479}\n  .global-notification.notification-info{background-color:#9dd3eb}\n  .global-notification.notification-success{background-color:#C5ED73}\n  .global-notification.notification-error{background-color:#d9534f;color:#fff;}\n  .global-notification.notification-error .close-button{color:#fff}\n  .global-notification.notification-error .close-button:hover{color:#ff9898}\n</style><div class="global-notification notification-{{data.type}}"><i ng-class="data.faIcon" ng-if="data.faIcon" class="fa fa-fw icon"></i> <strong ng-if="data.title">{{data.title}}:&nbsp;</strong><span ng-click="close()" ng-if="data.closeButton" class="close-button pull-right">✖</span> <span>{{data.message}}</span> <a ng-repeat="action in data.actions" ng-click="action.fn()" ng-class="action.className">{{action.label}}</a></div>'),e.put("app/templates/gmail-notification.html",'<div class="gmail-template"><style scoped="">\n    .gmail-template {\n      position: relative;\n      right: 0;\n      left: 0;\n      margin: 4px 0;\n      text-align: center;\n    }\n    .gmail-template div {\n      position: relative;\n      display: inline-block;\n      margin: 0 auto;\n\n      border:1px solid rgb(240, 195, 109);\n      background-color: rgb(249, 237, 190);\n      font-size: 13px;\n      font-weight: bold;\n      padding:2px 8px 2px 8px;\n\n      -webkit-transition: opacity 0.5s ease-out 4s;\n      -moz-transition: opacity 0.5s ease-out 4s;\n      -o-transition: opacity 0.5s ease-out 4s;\n      transition: opacity 0.5s ease-out 4s;\n    }\n    .gmail-template .gmail-template-error {\n      background-color: #DD8181;\n      border: 1px solid #D54B4B;\n    }\n    .gmail-template-close {\n      color: #9E9E9E;\n    }\n    .gmail-template-close:hover {\n      color: #505050;\n    }\n    .gmail-template-error .gmail-template-close {\n      color: #777777;\n    }\n    .gmail-template-error .gmail-template-close:hover {\n      color: #3B3B3B;\n    }\n    .gmail-template a {\n      cursor: pointer;\n      text-decoration: underline;\n    }\n  </style><div ng-class="\'gmail-template-\' + data.type"><i class="fa fa-fw" ng-class="data.faIcon" ng-if="data.faIcon"></i> {{data.title}}: {{data.message}} <a ng-repeat="action in data.actions" ng-click="action.fn()" ng-class="action.className">{{action.label}}</a> <i class="fa fa-fw fa-times gmail-template-close" ng-click="close()" ng-if="data.faIcon && data.closeButton"></i> <span class="gmail-template-close" ng-click="close()" ng-if="!data.faIcon && data.closeButton">✖</span></div></div>'),e.put("app/components/browser-info/browser-info.html",'<div class="modal-header"><button type="button" class="close" ng-click="vm.close()" aria-label="Close"><span aria-hidden="true">&times;</span></button><h3 class="modal-title">Information about browsers</h3></div><div class="modal-body"><h4>Firefox</h4><p>At least Firefox 36 is required, a more recent version is recommended.</p><p>Firefox will refuse to use any bit rate lower than a certain limit (200 kbps by default). In some situations, a lower bit rate can be useful to save bandwidth and processing power in the clients. This limit can be adjusted (a sensible value would be 64) modifying the <code>media.peerconnection.video.min_bitrate</code> setting at <a href="about:config">about:config</a>.</p><h4>Chrom(e/ium)</h4><p>Jangouts has been successfully tested with Chromium 41. It will probably work with older versions as well, but the usage of a version as recent as possible is recommended (see exception below).</p><p>There is a known bug in Chromium 46 that causes it to crash during initialization of WebRTC connections when running in sandbox mode (which is the default). If Chromium crashes when entering a Jangouts room, close it and execute it again adding the <code>--no-sandbox</code> parameter to the command line.</p></div><div class="modal-footer"><button class="btn btn-primary" ng-click="vm.close()">OK</button></div>'),e.put("app/components/browser-info/jh-browser-info.html",'<small><i class="fa fa-info-circle"></i> Tested with recent versions of Firefox, Chrome and Chromium. Please review the <a class="alert-link" href="#" ng-click="vm.showHelp()">detailed information</a> about browsers before proceeding.</small>'),e.put("app/components/chat/jh-chat-form.html",'<form name="chatMessage" ng-submit="vm.submit()"><div class="input-group"><input class="form-control input-sm" placeholder="Type your message here..." type="text" ng-model="vm.text" required=""> <span class="input-group-btn"><button class="btn btn-sm" ng-disabled="chatMessage.$invalid">Send</button></span></div></form>'),e.put("app/components/chat/jh-chat-message.html",'<div class="header"><strong>{{ vm.message.content.feed.display }}</strong> <small class="pull-right text-muted"><span class="glyphicon glyphicon-time"></span> {{ vm.message.timestamp | date:\'shortTime\' }}</small></div><ng-embed embed-data="vm.message.text()" embed-options="vm.embedOptions"></ng-embed>'),e.put("app/components/chat/jh-chat.html",'<div class="jh-chat panel panel-default"><div class="panel-body" id="jh-chat-messages"><ul><li ng-repeat="m in vm.messages"><jh-chat-message message="m" ng-if="m.type === \'chatMsg\'"></jh-chat-message><jh-log-entry message="m" ng-if="m.type !== \'chatMsg\'"></jh-log-entry></li></ul></div><div class="panel-footer" id="chat-form-footer"><jh-chat-form></jh-chat-form></div></div>'),e.put("app/components/chat/jh-log-entry.html",'<span class="log-entry">{{ vm.text }}</span>'),e.put("app/components/feed/jh-feed.html",'<figure ng-class="{\'own-feed\': vm.feed.isPublisher, sticky: vm.highlightedByUser}" ng-init="buttons=false" ng-mouseenter="buttons=true" ng-mouseleave="buttons=false"><div class="thumb"><video autoplay="" class="face" ng-class="{mirrored: vm.mirrored}" poster="assets/images/placeholder.png" ng-show="vm.thumbnailTag() === \'video\'"></video><img src="{{vm.feed.getPicture()}}" class="face" ng-class="{mirrored: vm.mirrored}" ng-show="vm.thumbnailTag() === \'picture\'"> <img ng-src="assets/images/placeholder.png" class="face" ng-class="{mirrored: vm.mirrored}" ng-show="vm.thumbnailTag() === \'placeholder\'"><canvas ng-show="false"></canvas><div class="buttons" ng-show="buttons"><div class="pull-left"><jh-sticky-button feed="vm.feed" click-fn="vm.toggleHighlightFn()" highlighted="vm.highlighted" sticky="vm.highlightedByUser"></jh-sticky-button></div><span class="pull-right"><jh-video-button feed="vm.feed"></jh-video-button><jh-ignore-button feed="vm.feed"></jh-ignore-button></span></div></div><figcaption><span class="caption">{{ vm.feed.display }}</span><div class="buttons"><jh-unpublish-button feed="vm.feed"></jh-unpublish-button><jh-audio-button feed="vm.feed"></jh-audio-button></div></figcaption></figure>'),e.put("app/components/feed/jh-main-feed.html",'<video autoplay=""></video>'),e.put("app/components/footer/jh-footer.html",'<footer class="footer"><div class="container-fluid"><span class="pull-left">© <a href="http://www.suse.com/" target="_blank">SUSE 2015</a></span> <span class="pull-right">Version {{ vm.version }}</span><div class="clearfix"></div></div></footer>'),e.put("app/components/room/jh-leave-button.html",'<button class="btn" ng-click="vm.leave()" title="Sign out"><span class="glyphicon glyphicon-log-out" aria-hidden="true"></span></button>'),e.put("app/components/screen-share/jh-screen-share-button.html",'<div style="display: inline-block;" tooltip="{{vm.title()}}" tooltip-placement="bottom"><button class="btn" ng-disabled="!vm.enabled()" ng-click="vm.click()"><span class="glyphicon glyphicon-blackboard" aria-hidden="true"></span></button></div>'),e.put("app/components/screen-share/jh-screen-share-hint.html",'<small ng-if="vm.visible()"><span ng-if="vm.usingSSL()">If you wish to use the screen sharing functionality, make sure you have understood <a class="alert-link" href="#" ng-click="vm.showHelp()">these instructions</a>.</span> <span ng-if="!vm.usingSSL()">Screen sharing will not work without SSL. If you want to make use of that functionality, access the <a class="alert-link" ng-href="{{vm.httpsUrl()}}">HTTPS version</a> of this site.</span></small>'),e.put("app/components/screen-share/screen-share-help.html",'<div class="modal-header"><button type="button" class="close" ng-click="vm.close()" aria-label="Close"><span aria-hidden="true">&times;</span></button><h3 class="modal-title">Screen sharing</h3></div><div class="modal-body"><p>Sharing your screen is an experimental feature in WebRTC and only works if the browser you\'re using meets particular requirements.</p><p>Active screen/window sharing will only work from Firefox if you have at least version 33 installed. In addition, two adjustments must be done in the settings at <a href="about:config">about:config</a>. First, make sure <code>media.getusermedia.screensharing.enabled</code> is enabled. Then, make sure <code>{{ vm.hostname() }}</code> is listed in <code>media.getusermedia.screensharing.allowed_domains</code>.</p><p>If you\'re using a recent version of Chrome (34+), you\'ll need to install <a href="https://chrome.google.com/webstore/detail/janus-webrtc-screensharin/hapfgfdkleiggjjpfpenajgdnfckjpaj">this extension</a>. If you\'re using an older verson of Chrome, instead, you\'ll need to manually enable the Chrome flag <a href="chrome://flags/#enable-usermedia-screen-capture">chrome://flags/#enable-usermedia-screen-capture</a>. Otherwise you\'ll get a permission error. Moreover, please beware that some versions of Chrome may only support the feature if you explicitly pass the <code>--enable-usermedia-screen-capturing</code> parameter on the command line.</p></div><div class="modal-footer"><button class="btn btn-primary" ng-click="vm.close()">OK</button></div>'),e.put("app/components/user/jh-signin-form.html",'<div class="form-signin"><div class="text-center"><img src="images/jangouts-logo.png" class="jangouts-logo-login"></div><form ng-submit="vm.signin()"><div class="form-group"><label class="sr-only" for="inputUsername">Username</label> <input id="inputUsername" class="form-control input-lg" type="text" ng-model="vm.username" required="true" placeholder="Username"></div><div class="form-group"><label class="sr-only" for="inputRoom">Room</label> <span ng-if="vm.showRoom()">{{ vm.room.label }}</span><select ng-if="vm.showRoomsList()" id="inputRoom" class="form-control input-lg" ng-model="vm.room" required="true" ng-options="room.label for room in vm.rooms track by room.id"><option value="" disabled="" selected="">Select a room</option></select></div><jh-thumbnails-mode-button text-template="true"></jh-thumbnails-mode-button><button id="signInButton" class="btn btn-lg btn-primary btn-block" type="submit">Sign in</button></form><div class="login-msg"><jh-browser-info></jh-browser-info><hr><jh-screen-share-hint></jh-screen-share-hint></div></div>'),e.put("app/components/videochat/jh-thumbnails-mode-button-with-text.html",'<div class="checkbox" tooltip="Disable to lower bandwidth and CPU usage" tooltip-placement="bottom"><label><input type="checkbox" ng-checked="vm.isChecked()" ng-click="vm.click()">Video thumbnails</label></div>'),e.put("app/components/videochat/jh-thumbnails-mode-button.html",'<button ng-class="{ \'btn-danger\': !vm.isChecked() }" class="btn" ng-click="vm.click()" title="Toggle Picture/Video thumbnails. Use picture mode to lower bandwidth and CPU usage"><span class="glyphicon" ng-class="{ \'glyphicon-picture\': !vm.isChecked(), \'glyphicon-facetime-video\': vm.isChecked() }" aria-hidden="true"></span></button>'),e.put("app/components/videochat/jh-video-chat.html",'<div class="row"><header><div class="row"><div class="col-xs-12 col-sm-4"><img src="images/jangouts-logo.png" id="logo"></div><div class="col-xs-12 col-sm-8 text-right"><jh-thumbnails-mode-button></jh-thumbnails-mode-button><jh-screen-share-button></jh-screen-share-button><button class="btn" ng-click="vm.showHotkeys()" title="Keyboard shortcuts"><span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span></button> <button ng-show="vm.windowResizeModeOn" class="btn" ng-click="vm.setDefaultLayout()" title="Reset layout to default"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></button> <button ng-class="{ \'btn-danger\': vm.windowResizeModeOn }" class="btn" ng-click="vm.toggleWindowResizeMode()" title="Window resize mode"><span class="glyphicon glyphicon-pushpin" aria-hidden="true"></span></button><jh-leave-button></jh-leave-button></div></div></header></div><div class="row" id="videochat-body"><div gridster="vm.gridsterOpts" id="videochat-playroom"><ul><li gridster-item="" row="item.position[0]" col="item.position[1]" size-x="item.size[0]" size-y="item.size[1]" ng-repeat="item in vm.gridsterItems"><div ng-if="item.content === \'Speaker\'" class="grid-item-content" id="main-video" jh-main-feed="true" feed="vm.highlightedFeed()" ng-class="{mirrored: vm.mirrored()}"></div><div ng-if="item.content === \'Participants\'" class="grid-item-content" id="thumbnails"><div jh-feed="true" feed="f" ng-repeat="f in vm.feeds() | orderBy:\'+display\'" toggle-highlight-fn="vm.toggleHighlightedFeed(f)" highlighted="vm.isHighlighted(f)" highlighted-by-user="vm.isHighlightedByUser(f)"></div></div><div ng-if="item.content === \'Chat\'" class="grid-item-content"><jh-chat messages="vm.logEntries()"></jh-chat></div></li></ul></div></div>'),e.put("app/components/feed/buttons/jh-audio-button.html",'<button type="button" class="btn btn-xs" ng-class="{\'btn-primary\': vm.feed.getSpeaking(), \'btn-default\': !vm.feed.getSpeaking()}" ng-click="vm.toggle()" title="Disable audio" ng-show="vm.showsDisable()"><span class="glyphicon glyphicon-volume-up"></span></button><button type="button" class="btn btn-xs btn-danger" ng-click="vm.toggle()" title="Enable audio" ng-show="vm.showsEnable()"><span class="glyphicon glyphicon-volume-off"></span></button><button type="button" disabled="" class="btn btn-xs btn-danger" title="Audio disabled" ng-show="vm.showsAudioOff()"><span class="glyphicon glyphicon-volume-off"></span></button>'),e.put("app/components/feed/buttons/jh-ignore-button.html",'<button type="button" class="btn btn-xs btn-default" ng-click="vm.ignore()" title="Ignore" ng-show="vm.showsIgnore()"><span class="glyphicon glyphicon-ban-circle"></span></button><button type="button" class="btn btn-xs btn-danger" ng-click="vm.stopIgnoring()" title="Stop ignoring" ng-show="vm.showsStopIgnoring()"><span class="glyphicon glyphicon-ban-circle"></span></button>'),e.put("app/components/feed/buttons/jh-sticky-button.html",'<button type="button" class="btn btn-xs btn-default" ng-click="vm.click()" title="Sticky as main video" ng-show="vm.showsEnable()"><span class="glyphicon glyphicon-pushpin"></span></button><button type="button" class="btn btn-xs btn-danger" ng-click="vm.click()" title="Unstick" ng-show="vm.showsDisable()"><span class="glyphicon glyphicon-pushpin"></span></button>'),e.put("app/components/feed/buttons/jh-unpublish-button.html",'<button type="button" class="btn btn-xs btn-default" ng-click="vm.click()" title="Stop sharing" ng-show="vm.isVisible()"><span class="glyphicon glyphicon-remove"></span></button>'),e.put("app/components/feed/buttons/jh-video-button.html",'<button type="button" class="btn btn-xs btn-default" ng-click="vm.toggle()" title="Disable video" ng-show="vm.showsDisable()"><span class="glyphicon glyphicon-eye-open"></span></button><button type="button" class="btn btn-xs btn-danger" ng-click="vm.toggle()" title="Enable video" ng-show="vm.showsEnable()"><span class="glyphicon glyphicon-eye-close"></span></button>')}]);